package com.example.androidmalwaredetector.utilities;

import android.util.Log;

import org.xmlpull.v1.XmlPullParser;
import org.xmlpull.v1.XmlPullParserFactory;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.List;

public class ManifestParser {
    static String xmlString;
    static String TAG = "ManifestParser";
    ManifestParser(String xmlString) {
        ManifestParser.xmlString = xmlString;
    }

    public List<Integer> getInputArray() {
        List<Integer> l = new ArrayList<>();
        try {
            XmlPullParserFactory xmlFactoryObject = XmlPullParserFactory.newInstance();
            XmlPullParser myParser = xmlFactoryObject.newPullParser();
            InputStream targetStream = new ByteArrayInputStream(xmlString.getBytes());
            myParser.setInput(targetStream, null);
            features f = new features();
            int event = myParser.getEventType();
            while (event != XmlPullParser.END_DOCUMENT)  {
                String name=myParser.getName();
                if(name != null){
                    //Log.d(TAG, name);
                    if(name.equals("uses-permission")) {
                       // Log.d(TAG, "Permission: " + myParser.getAttributeValue(null,"android:name"));
                        f.add(myParser.getAttributeValue(null,"android:name"));
                    }
                    else if(name.equals("service")){
                        try {
                            Log.d(TAG, myParser.getAttributeValue(null, "android:name"));
                        }
                        catch (Exception ignored){}
                    }
                }
                event = myParser.next();
            }
            l = f.getPermList();
        } catch (Exception e) {
            Log.d(TAG, "Error: " + e.toString());
        }

        return l;
    }

}
