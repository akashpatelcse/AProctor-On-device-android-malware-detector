package com.example.androidmalwaredetector.utilities;

import android.content.Context;
import android.util.Log;
import android.widget.Toast;

import net.dongliu.apk.parser.ApkFile;
import net.dongliu.apk.parser.bean.ApkMeta;
import net.dongliu.apk.parser.bean.UseFeature;

import java.io.File;
import java.io.IOException;
import java.util.List;

public class apkDetails {
    String pkgName;
    String appName;
    String appSize;
    int MalwareProb;
    int GoodwareProb;
    int isMalware;
    String time;

    public apkDetails(String pkgName,String algo, Context context){
        this.pkgName = pkgName;
        this.appName = InstalledAppInfo.getAppName(pkgName, context);
        this.appSize = InstalledAppInfo.getAPKSize(InstalledAppInfo.getSourceDir(this.pkgName, context));

        String fullFilePath = InstalledAppInfo.getSourceDir(pkgName, context);

//        try (ApkFile apkFile = new ApkFile(new File(fullFilePath))) {
//            ApkMeta apkMeta = apkFile.getApkMeta();
//            this.appName = apkMeta.getName();
//        } catch (IOException e) {
//            e.printStackTrace();
//        }

        Long start = System.currentTimeMillis();
        String manifest = Utils.getManifest(InstalledAppInfo.getSourceDir(pkgName, context));
        ManifestParser manifestParser = new ManifestParser(manifest, 1);
        List<Integer> inputArray = manifestParser.getInputArray();
        classifier c = new classifier();
        this.GoodwareProb = c.classify(inputArray, algo,context);

        Long end = System.currentTimeMillis();
        long elapsedTime = end - start;
        this.time = Long.toString(elapsedTime) + " Milli Sec";
        MalwareProb = 100-GoodwareProb;
        if(MalwareProb > GoodwareProb) isMalware = 1;
        else isMalware = 0;
    }

    public String getTime() {
        return time;
    }

    public String getPkgName() {
        return pkgName;
    }

    public String getAppName() {
        return appName;
    }

    public String getAppSize() {
        return appSize;
    }

    public int getIsMalware() {
        return isMalware;
    }

    public int getGoodwareProb() {
        return GoodwareProb;
    }

    public int getMalwareProb() {
        return MalwareProb;
    }
}
